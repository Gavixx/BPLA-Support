//---------------------------------------------------------------------------

#include <vcl.h>
#pragma hdrstop

#include "VolonterForm.h"
#include "DataModule.h"
//---------------------------------------------------------------------------
#pragma package(smart_init)
#pragma resource "*.dfm"
TForm4 *Form4;
//---------------------------------------------------------------------------
__fastcall TForm4::TForm4(TComponent* Owner, String userName)
    : TForm(Owner), UserName(userName)
{
}
//---------------------------------------------------------------------------



void __fastcall TForm4::LoadDB()  {
 // Переконайтесь, що з'єднання до бази даних активно
	if (!DataModule1->FDConnection1->Connected) {
        DataModule1->ConnectToDatabase();
	}

    // Закриваємо попередній запит перед відкриттям нового
	DataModule1->FDQuery1->Close();

	// Налаштовуємо запит через DataModule1
	DataModule1->FDQuery1->SQL->Text = "SELECT DM.drone_name, DM.drone_type, MR.quantity, MR.request_date, MR.status, MR.fulfilled_quantity "
									   "FROM MilitaryRequests MR "
									   "JOIN DroneModel DM ON MR.drone_id = DM.drone_id "
										"WHERE MR.status = 'In Progress'";
	DataModule1->FDQuery1->Open();  // Виконує запит та відкриває результати

	if (DataModule1->FDQuery1->RecordCount > 0) {
		// Прив'язка даних до DataSource через DataModule1
		DataModule1->DataSource1->DataSet = DataModule1->FDQuery1;

		// Прив'язка DataSource до DBGrid через DataModule1
		DBGrid1->DataSource = DataModule1->DataSource1;

		// Налаштування стилю колонок DBGrid
//		SetDBGridColumnsStyles();
	} else {
        ShowMessage("Немає даних для відображення.");
	}               }

void __fastcall TForm4::FormShow(TObject *Sender)
{
	   LoadDB();
	// Відображення в Label або інший спосіб показу імені
	LabelWelcom->Caption = "Welcome, " + UserName + "!";
}
//---------------------------------------------------------------------------

