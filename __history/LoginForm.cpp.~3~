//---------------------------------------------------------------------------

#include <vcl.h>
#pragma hdrstop
#include "AdminForm.h"
#include "LoginForm.h"
//---------------------------------------------------------------------------
#pragma package(smart_init)
#pragma resource "*.dfm"
TForm1 *Form1;
//---------------------------------------------------------------------------
__fastcall TForm1::TForm1(TComponent* Owner)
	: TForm(Owner)
{
}
//---------------------------------------------------------------------------

void __fastcall TForm1::LoginButtonClick(TObject *Sender)
{

	bool status = false;
	String enteredUsername = EditLogin->Text;
	String enteredPassword = EditPassword->Text;
try {
		// Підключаємося до бази даних
		FDConnection1->Connected = true;

		// SQL-запит для пошуку користувача за логіном
		FDQuery1->SQL->Text = "SELECT password_hash FROM Users WHERE username = :username";
		FDQuery1->ParamByName("username")->AsString = enteredUsername;

		// Виконуємо запит
		FDQuery1->Open();

		// Перевіряємо, чи знайдено користувача
		if (!FDQuery1->Eof) {
			// Отримуємо пароль із бази даних
			String storedPassword = FDQuery1->FieldByName("password_hash")->AsString;

			// Перевіряємо, чи збігається введений пароль із тим, що в базі
			if (enteredPassword == storedPassword) {
				if (enteredUsername == "admin") {
				 AdminForm *adminform = new AdminForm(this);  // Створюємо нову форму
				 adminFormH->Show();
				this->Close();}
				else if(enteredUsername == "army"){}
				else{

                }



			} else {
				ShowMessage("Ivalid login or password");
			}
		} else {
			ShowMessage("Ivalid login or password");
		}

		// Закриваємо запит і з'єднання
		FDQuery1->Close();
		FDConnection1->Connected = false;
	}
	catch (Exception &e) {
		ShowMessage("Помилка: " + e.Message);
	}





}
//---------------------------------------------------------------------------

